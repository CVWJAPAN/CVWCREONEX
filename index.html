<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>CVWJAPAN 児童相談AI室（Gemini・匿名）</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body { background: #fff; color: #222; font-family: 'Noto Sans JP', sans-serif; margin: 0; }
    .header { background: #19ffe5; color: #fff; padding: 1em; font-size: 1.3em; text-align: center; letter-spacing: 0.1em; }
    .chat { max-width: 500px; margin: 30px auto; border-radius: 16px; box-shadow: 0 0 16px #aaa6, 0 2px 6px #6ff4; padding: 2em; background: #fafbfc; }
    .bubble { margin: 0.7em 0; padding: 0.8em 1em; border-radius: 1.2em; }
    .ai { background: #e7f6fb; align-self: flex-start; }
    .user { background: #ffbef7; align-self: flex-end; text-align: right; }
    .input-area { display: flex; gap: 0.5em; margin-top: 1.5em; }
    input, button { font-size: 1em; border-radius: 8px; border: none; padding: 0.7em; }
    input { flex: 1; border: 1px solid #bbb; }
    button { background: #ff34b1; color: #fff; font-weight: bold; cursor: pointer; }
    .footer { font-size: 0.9em; color: #666; text-align: center; margin: 1em 0; }
    .policy { font-size: 0.85em; margin-top: 1em; color: #444; background: #faf5e7; padding: 1em; border-radius: 10px; }
  </style>
</head>
<body>
  <div class="header">CVWJAPAN 児童相談AI室（Gemini・匿名・記録非保持）</div>
  <div class="chat" id="chat">
    <div class="ai bubble">こんにちは。ここは匿名の相談室です。あなたの話をなんでも聞かせてください。（※記録はあなたの端末だけ／AIとあなた以外、誰にも見られません）</div>
  </div>
  <div class="chat input-area">
    <input id="userInput" placeholder="相談内容を入力..." autocomplete="off"/>
    <button onclick="sendMsg()">送信</button>
  </div>
  <div class="chat">
    <div class="policy">
      この相談室は完全匿名・記録非保持です。入力された情報は外部サーバーに一切保存されません。<br>
      <b>※危険や命に関わる状況は、すぐ地域の支援先や大人にも相談しましょう。</b>
    </div>
  </div>
  <div class="footer">
    &copy; 2025 一般社団法人CVWJAPAN<br>
    AI：Google Gemini Pro / 開発：NOBUSHI
  </div>
<script>
const API_KEY = "AIzaSyCvl3ayl8ahk9Q-ZNB5-H9Ja8chv0sHawI"; // ←ここを自分のAPIキーに書き換え
let history = [
  {role: "user", parts: [{text: "あなたは日本の児童相談室AIです。優しく、親身に、子どもや保護者の気持ちに寄り添い、匿名性と安心感を大切にします。"}]}
];

function escapeHTML(s) {
  return s.replace(/</g,"&lt;").replace(/>/g,"&gt;");
}

async function sendMsg() {
  const input = document.getElementById('userInput');
  const userText = input.value.trim();
  if(!userText) return;
  input.value = '';
  appendMsg('user', userText);
  history.push({role:"user", parts:[{text:userText}]});
  // Gemini APIエンドポイント
  const response = await fetch("https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key="+API_KEY,{
    method: "POST",
    headers: { "Content-Type":"application/json" },
    body: JSON.stringify({
      contents: history
    })
  });
  const data = await response.json();
  let aiMsg = "";
  if(data.candidates && data.candidates.length && data.candidates[0].content.parts.length){
    aiMsg = data.candidates[0].content.parts[0].text;
    appendMsg('ai', aiMsg);
    history.push({role:"model", parts:[{text:aiMsg}]});
  } else {
    appendMsg('ai', "（AI応答が取得できませんでした。しばらくしてからもう一度お試しください）");
  }
}

function appendMsg(type, msg) {
  const div = document.createElement('div');
  div.className = type+" bubble";
  div.innerHTML = escapeHTML(msg).replace(/\n/g,"<br>");
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}
</script>
</body>
</html>
