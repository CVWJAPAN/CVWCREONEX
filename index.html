<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>CHAGAデジタル相談室</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { font-family: "Arial", sans-serif; background: #f0f8ff; margin: 0; padding: 0; display: flex; flex-direction: column; height: 100vh; }
        header { background: #0099cc; color: white; padding: 1em; text-align: center; font-size: 1.2em; }
        #chatbox { flex: 1; overflow-y: auto; padding: 1em; background: #fff; }
        .msg { margin: 0.5em 0; padding: 0.5em 1em; border-radius: 5px; max-width: 80%; }
        .user { color: blue; text-align: right; background: #e6f3ff; margin-left: auto; }
        .bot { color: green; text-align: left; background: #e6ffe6; margin-right: auto; }
        #inputArea { display: flex; padding: 1em; background: #f0f0f0; }
        #userInput { flex: 1; padding: 0.8em; font-size: 1em; border: 1px solid #ccc; border-radius: 5px; }
        button { margin-left: 0.5em; padding: 0.8em 1em; background: #0099cc; color: white; border: none; border-radius: 5px; font-size: 1em; cursor: pointer; }
        button:disabled { background: #666; cursor: not-allowed; }
        @media (max-width: 600px) {
            header { font-size: 1em; }
            button { font-size: 0.9em; padding: 0.6em 0.8em; }
        }
    </style>
</head>
<body>
    <header>CHAGAデジタル相談室</header>
    <div id="chatbox" role="log" aria-live="polite">
        <div class="msg bot">こんにちは！何でも話してね。</div>
    </div>
    <div id="inputArea">
        <input type="text" id="userInput" placeholder="ここに入力..." aria-label="メッセージ入力" />
        <button onclick="sendMessage()" aria-label="メッセージを送信">送信</button>
    </div>

    <script>
        const input = document.getElementById("userInput");
        const chatbox = document.getElementById("chatbox");
        const button = document.querySelector("button");
        const API_KEY = "xai-KwwUVf9xPs3IC4kRkP4Z20tdhi2R3DuppsVsJfLU2F1TphbnOY526GpxwBJm8soxq4iTRDsF38tZ7JaZ"; // テスト用。実際はサーバーサイドで管理

        // Enterキーでの送信対応
        input.addEventListener("keypress", (e) => {
            if (e.key === "Enter") sendMessage();
        });

        async function sendMessage() {
            const userText = input.value.trim();
            if (!userText) return;

            // ユーザーメッセージを表示
            const userMsg = document.createElement("div");
            userMsg.className = "msg user";
            userMsg.textContent = "あなた: " + userText;
            chatbox.appendChild(userMsg);
            input.value = "";

            // ローディング表示
            const botMsg = document.createElement("div");
            botMsg.className = "msg bot";
            botMsg.textContent = "処理中...";
            chatbox.appendChild(botMsg);
            chatbox.scrollTop = chatbox.scrollHeight;

            // 送信ボタンを無効化
            button.disabled = true;

            try {
                // Grok 3 APIへのリクエスト
                const response = await fetch("https://api.x.ai/v1/chat/completions", {
                    method: "POST",
                    headers: {
                        "Authorization": `Bearer ${API_KEY}`,
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        model: "grok-3",
                        messages: [{ role: "user", content: userText }],
                        max_tokens: 200,
                        temperature: 0.7
                    })
                });

                if (!response.ok) throw new Error(`APIエラー: ${response.status}`);

                const data = await response.json();
                botMsg.textContent = "AI: " + (data.choices[0]?.message?.content || "応答がありません");
            } catch (error) {
                botMsg.textContent = "AI: エラー: " + error.message;
            } finally {
                button.disabled = false;
                chatbox.scrollTop = chatbox.scrollHeight;
            }
        }
    </script>
</body>
</html>
